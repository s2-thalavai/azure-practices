# Azure Kubernetes Commands

## 1. How many nodes are there?

```bash
kubectl get nodes
```
```
NAME                     STATUS   ROLES   AGE    VERSION
aks-agentpool-1234-234   Ready    agent   554d   v1.27.9
```

Count nodes:

```bash
kubectl get nodes --no-headers | wc -l
```

## 2. Node CPU & Memory Usage

Needs metrics-server installed
Check with: kubectl top nodes

```bash
kubectl top nodes
```
```
NAME                           CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)
aks-agentpool-1234-234         248m         6%       13719Mi         109%
```

## 3. Allocatable CPU & Memory per Node

```bash
kubectl get nodes -o custom-columns=NODE:.metadata.name,CPU_ALLOC:.status.allocatable.cpu,MEM_ALLOC:.status.allocatable.memory
```
```
NODE                        CPU_ALLOC   MEM_ALLOC
aks-agentpool-1234-234      3860m       12879660Ki

| Field              | Value                  | Meaning                                      |
| ------------------ | ---------------------- | -------------------------------------------- |
| Node               | aks-agentpool-1234-234 | AKS worker node                              |
| CPU allocatable    | **3860m**              | ~3.86 vCPU available to pods                 |
| Memory allocatable | **12879660Ki**         | ~12.28 GiB (~13.19 GB) RAM available to pods |
```
## 4. How many pods are running?

```bash
kubectl get pods -A
```

```
NAMESPACE           NAME                                                      READY   STATUS    RESTARTS          AGE
calico-system       calico-kube-controllers-74dffdfc85-2g4dw                  1/1     Running   0                 554d
calico-system       calico-node-w8769                                         1/1     Running   0                 554d
calico-system       calico-typha-77b5d56849-f9hf8                             1/1     Running   0                 554d
gatekeeper-system   gatekeeper-audit-6db468d85-j8mth                          1/1     Running   0                 7d5h
gatekeeper-system   gatekeeper-controller-5444bc796b-j8j9n                    1/1     Running   0                 7d5h
gatekeeper-system   gatekeeper-controller-5444bc796b-mts6p                    1/1     Running   0                 7d5h
```

Count pods:

```bash
kubectl get pods -A --no-headers | wc -l
```

42

## 5. Pods per Node

Node Pod Capacity (Max Pods per node)

```bash
kubectl get nodes -o custom-columns=NODE:.metadata.name,PODS_CAP:.status.capacity.pods
```

## 6. Find heavy pods

```bash
kubectl top pods -A --sort-by=memory
kubectl top pods -A --sort-by=cpu
```

